<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TASK | TARGET - Productivity Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    :root {
      --primary: #5e35b1;
      --primary-light: #7e57c2;
      --primary-dark: #4527a0;
      --secondary: #26a69a;
      --accent: #ff7043;
      --success: #66bb6a;
      --warning: #ffa726;
      --danger: #ef5350;
      --dark: #263238;
      --light: #f5f5f5;
      --ultra-light: #ffffff;
      --gray: #b0bec5;
      --dark-gray: #78909c;
      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, #00897b 100%);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);
      --border-radius-sm: 8px;
      --border-radius-md: 12px;
      --border-radius-lg: 16px;
      --transition-fast: 0.15s ease;
      --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--light);
      color: var(--dark);
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: var(--light);
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(94, 53, 177, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(38, 166, 154, 0.05) 0%, transparent 20%);
    }

    #app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* Header */
    .header {
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header-content {
      flex: 1;
    }

    /* Cards */
    .card {
      background: var(--ultra-light);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      transition: var(--transition-medium);
      margin-bottom: 1.5rem;
      border: none;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header {
      padding: 1.25rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: rgba(245, 245, 245, 0.7);
    }

    .card-body {
      padding: 1.25rem;
    }

    /* Typography */
    h1, h2, h3, h4 {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      line-height: 1.2;
      color: var(--dark);
    }

    h1 {
      font-size: 2rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
      position: relative;
      display: inline-block;
    }

    h1::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 50px;
      height: 4px;
      background: var(--gradient-primary);
      border-radius: 2px;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    h3 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }

    .text-muted {
      color: var(--dark-gray);
      font-size: 0.95rem;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.25rem;
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: var(--transition-fast);
      border: none;
      outline: none;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.15);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .btn:hover::before {
      transform: translateX(0);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .btn-primary:hover {
      box-shadow: 0 5px 15px rgba(94, 53, 177, 0.3);
    }

    .btn-secondary {
      background: var(--gradient-secondary);
      color: white;
    }

    .btn-secondary:hover {
      box-shadow: 0 5px 15px rgba(38, 166, 154, 0.3);
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    /* Forms */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: var(--border-radius-sm);
      font-family: inherit;
      font-size: 1rem;
      transition: var(--transition-fast);
      background: var(--ultra-light);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.2);
    }

    .input-group {
      display: flex;
      gap: 1rem;
    }

    .input-group .form-control {
      flex: 1;
    }

    /* Task List */
    .task-list {
      display: grid;
      gap: 0.75rem;
    }

    .task-item {
      display: flex;
      align-items: center;
      padding: 1rem 1.25rem;
      background: var(--ultra-light);
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-sm);
      transition: var(--transition-fast);
      cursor: pointer;
    }

    .task-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .task-item.done {
      opacity: 0.8;
      background: rgba(0, 0, 0, 0.02);
    }

    .task-item.done .task-content {
      text-decoration: line-through;
      color: var(--gray);
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--gray);
      border-radius: 6px;
      margin-right: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-fast);
      cursor: pointer;
      flex-shrink: 0;
      font-size: 0.8rem;
    }

    .task-item.done .task-checkbox {
      background: var(--success);
      border-color: var(--success);
      color: white;
    }

    .task-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .task-title {
      font-weight: 600;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .task-meta {
      display: flex;
      gap: 0.75rem;
      font-size: 0.85rem;
      color: var(--dark-gray);
      flex-wrap: wrap;
    }

    .task-priority {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .priority-high {
      background: rgba(239, 83, 80, 0.1);
      color: var(--danger);
    }

    .priority-medium {
      background: rgba(255, 167, 38, 0.1);
      color: var(--warning);
    }

    .priority-low {
      background: rgba(102, 187, 106, 0.1);
      color: var(--success);
    }

    .task-actions {
      display: flex;
      gap: 0.5rem;
      margin-left: 0.75rem;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.25rem;
      margin-top: 1.25rem;
    }

    .stat-card {
      padding: 1.25rem;
      border-radius: var(--border-radius-md);
      background: var(--ultra-light);
      box-shadow: var(--shadow-sm);
      transition: var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .stat-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient-primary);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
      margin: 0.5rem 0;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--dark-gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Progress Bars */
    .progress-container {
      margin-top: 0.75rem;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.8rem;
      color: var(--dark-gray);
    }

    .progress-bar {
      height: 6px;
      border-radius: 3px;
      background: rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 3px;
      background: var(--gradient-primary);
      transition: width 0.5s ease;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 2.5rem 1.5rem;
      color: var(--gray);
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .empty-state h4 {
      margin-bottom: 0.5rem;
      color: var(--dark-gray);
    }

    .empty-state p {
      font-size: 0.95rem;
    }

    /* Layout */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 1.5rem;
    }

    .sidebar {
      position: sticky;
      top: 1.5rem;
      height: fit-content;
    }

    /* Charts */
    .chart-container {
      position: relative;
      width: 100%;
      margin-top: 1rem;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: static;
      }
    }

    @media (max-width: 768px) {
      #app {
        padding: 1rem;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .input-group {
        flex-direction: column;
        gap: 1rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.75rem;
      }
      
      .card-header, .card-body {
        padding: 1rem;
      }
      
      .btn {
        padding: 0.65rem 1rem;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-fade {
      animation: fadeIn 0.3s ease forwards;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      max-width: 320px;
      width: 100%;
    }

    .toast {
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: var(--border-radius-md);
      background: var(--ultra-light);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      opacity: 0;
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .toast-success .toast-icon {
      color: var(--success);
    }

    .toast-warning .toast-icon {
      color: var(--warning);
    }

    .toast-error .toast-icon {
      color: var(--danger);
    }

    .toast-info .toast-icon {
      color: var(--primary);
    }

    .toast-body {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--dark);
    }

    .toast-message {
      font-size: 0.9rem;
      color: var(--dark-gray);
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--gray);
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0;
      margin-left: 0.5rem;
      transition: color 0.2s ease;
    }

    .toast-close:hover {
      color: var(--dark);
    }

    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="toast-container" id="toastContainer"></div>
    <div class="confetti-container" id="confettiContainer"></div>

    <header class="header">
      <div class="header-content">
        <h1>TASK | TARGET</h1>
        <p class="text-muted">Your personal productivity companion</p>
      </div>
      <button class="btn btn-secondary" id="aiSuggestBtn">
        <span>ü§ñ</span> AI Suggestions
      </button>
    </header>

    <div class="main-grid">
      <main>
        <div class="card">
          <div class="card-header">
            <h3>Task Management</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label for="taskName" class="form-label">Task Name</label>
              <input type="text" id="taskName" class="form-control" placeholder="What needs to be done?">
            </div>
            
            <div class="input-group">
              <div class="form-group" style="flex: 1;">
                <label for="taskTime" class="form-label">Time</label>
                <input type="time" id="taskTime" class="form-control">
              </div>
              
              <div class="form-group" style="flex: 1;">
                <label for="taskPriority" class="form-label">Priority</label>
                <select id="taskPriority" class="form-control">
                  <option value="low">Low</option>
                  <option value="medium" selected>Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
            </div>
            
            <button class="btn btn-primary" id="addTaskBtn" style="width: 100%;">
              <span>‚ûï</span> Add Task
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3>Today's Tasks</h3>
            <div class="text-muted">
              <span id="completedCount">0</span> of <span id="totalCount">0</span> completed
            </div>
          </div>
          <div class="card-body">
            <div class="task-list" id="taskList">
              <div class="empty-state">
                <div class="empty-icon">üì≠</div>
                <h4>No tasks scheduled</h4>
                <p>Add your first task to begin your productivity journey</p>
              </div>
            </div>
          </div>
        </div>
      </main>
      
      <aside class="sidebar">
        <div class="card">
          <div class="card-header">
            <h3>Performance</h3>
          </div>
          <div class="card-body">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label">Productivity Score</div>
                <div class="stat-value" id="points">100</div>
                <div class="progress-container">
                  <div class="progress-label">
                    <span>Level 1</span>
                    <span>Level 2</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" id="levelProgress" style="width: 20%"></div>
                  </div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Current Streak</div>
                <div class="stat-value" id="streak">0</div>
                <div class="progress-container">
                  <div class="progress-label">
                    <span>Day 1</span>
                    <span>Day 7</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" id="streakProgress" style="width: 0%"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card" style="margin-top: 1.5rem;">
              <div class="card-header">
                <h3>Productivity Trends</h3>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="productivityChart" height="200"></canvas>
                </div>
              </div>
            </div>
            
            <div class="card" style="margin-top: 1.5rem;">
              <div class="card-header">
                <h3>Task Priority</h3>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="priorityChart" height="200"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card" style="margin-top: 1.5rem;">
          <div class="card-header">
            <h3>Recent Achievements</h3>
          </div>
          <div class="card-body">
            <div id="achievementsList" style="display: grid; gap: 1rem;">
              <div class="empty-state" style="padding: 1.5rem;">
                <div class="empty-icon">üèÜ</div>
                <p>Complete tasks to earn achievements</p>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Function to generate productivity data for the last 7 days
  function generateProductivityData() {
    const dates = [];
    const completed = [];
    const total = [];
    
    for (let i = 6; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      const dateString = date.toDateString();
      
      const dayTasks = tasks.filter(t => t.date === dateString);
      const dayCompleted = dayTasks.filter(t => t.done).length;
      
      dates.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
      completed.push(dayCompleted);
      total.push(dayTasks.length);
    }
    
    return { dates, completed, total };
  }
  
  // Function to generate priority distribution data
  function generatePriorityData() {
    const high = tasks.filter(t => t.priority === 'high').length;
    const medium = tasks.filter(t => t.priority === 'medium').length;
    const low = tasks.filter(t => t.priority === 'low').length;
    
    return { high, medium, low };
  }
  
  // Initialize charts when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    // Productivity Trend Chart
    const productivityCtx = document.getElementById('productivityChart').getContext('2d');
    const productivityData = generateProductivityData();
    
    new Chart(productivityCtx, {
      type: 'line',
      data: {
        labels: productivityData.dates,
        datasets: [
          {
            label: 'Completed Tasks',
            data: productivityData.completed,
            borderColor: '#4361ee',
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            tension: 0.3,
            fill: true
          },
          {
            label: 'Total Tasks',
            data: productivityData.total,
            borderColor: '#f72585',
            backgroundColor: 'rgba(247, 37, 133, 0.1)',
            tension: 0.3,
            borderDash: [5, 5]
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return `${context.dataset.label}: ${context.raw}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1
            }
          }
        }
      }
    });
    
    // Priority Distribution Chart
    const priorityCtx = document.getElementById('priorityChart').getContext('2d');
    const priorityData = generatePriorityData();
    
    new Chart(priorityCtx, {
      type: 'doughnut',
      data: {
        labels: ['High', 'Medium', 'Low'],
        datasets: [{
          data: [priorityData.high, priorityData.medium, priorityData.low],
          backgroundColor: [
            'rgba(239, 35, 60, 0.7)',
            'rgba(255, 159, 28, 0.7)',
            'rgba(46, 196, 182, 0.7)'
          ],
          borderColor: [
            'rgba(239, 35, 60, 1)',
            'rgba(255, 159, 28, 1)',
            'rgba(46, 196, 182, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const value = context.raw;
                const percentage = Math.round((value / total) * 100);
                return `${context.label}: ${value} (${percentage}%)`;
              }
            }
          }
        }
      }
    });
  });
  
  // Update charts when tasks change
  function updateCharts() {
    // You would need to store chart instances and update their data here
    // For simplicity, we'll just recreate them
    const productivityData = generateProductivityData();
    const priorityData = generatePriorityData();
    
    // In a real app, you would update the existing charts instead of recreating them
    document.querySelectorAll('canvas').forEach(canvas => {
      canvas.remove();
    });
    
    // Recreate the canvas elements
    const productivityChartDiv = document.createElement('canvas');
    productivityChartDiv.id = 'productivityChart';
    productivityChartDiv.height = 250;
    document.querySelector('#productivityChart').parentNode.appendChild(productivityChartDiv);
    
    const priorityChartDiv = document.createElement('canvas');
    priorityChartDiv.id = 'priorityChart';
    priorityChartDiv.height = 200;
    document.querySelector('#priorityChart').parentNode.appendChild(priorityChartDiv);
    
    // Reinitialize charts
    const productivityCtx = productivityChartDiv.getContext('2d');
    new Chart(productivityCtx, {
      type: 'line',
      data: {
        labels: productivityData.dates,
        datasets: [
          {
            label: 'Completed Tasks',
            data: productivityData.completed,
            borderColor: '#4361ee',
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            tension: 0.3,
            fill: true
          },
          {
            label: 'Total Tasks',
            data: productivityData.total,
            borderColor: '#f72585',
            backgroundColor: 'rgba(247, 37, 133, 0.1)',
            tension: 0.3,
            borderDash: [5, 5]
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return `${context.dataset.label}: ${context.raw}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1
            }
          }
        }
      }
    });
    
    const priorityCtx = priorityChartDiv.getContext('2d');
    new Chart(priorityCtx, {
      type: 'doughnut',
      data: {
        labels: ['High', 'Medium', 'Low'],
        datasets: [{
          data: [priorityData.high, priorityData.medium, priorityData.low],
          backgroundColor: [
            'rgba(239, 35, 60, 0.7)',
            'rgba(255, 159, 28, 0.7)',
            'rgba(46, 196, 182, 0.7)'
          ],
          borderColor: [
            'rgba(239, 35, 60, 1)',
            'rgba(255, 159, 28, 1)',
            'rgba(46, 196, 182, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const value = context.raw;
                const percentage = Math.round((value / total) * 100);
                return `${context.label}: ${value} (${percentage}%)`;
              }
            }
          }
        }
      }
    });
  }
  
  // Call updateCharts when tasks change
  function save() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
    localStorage.setItem("points", points);
    localStorage.setItem("streak", streak);
    localStorage.setItem("level", level);
    localStorage.setItem("lastDay", new Date().toDateString());
    localStorage.setItem("achievements", JSON.stringify(achievements));
    updateStats();
    updateCharts(); // Add this line to update charts when data changes
  }
  
    // DOM Elements
    const addTaskBtn = document.getElementById('addTaskBtn');
    const aiSuggestBtn = document.getElementById('aiSuggestBtn');
    const taskList = document.getElementById('taskList');
    const toastContainer = document.getElementById('toastContainer');
    const confettiContainer = document.getElementById('confettiContainer');
    
    // State
    let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
    let points = parseInt(localStorage.getItem("points") || "100");
    let streak = parseInt(localStorage.getItem("streak") || "0");
    let level = parseInt(localStorage.getItem("level") || "1");
    let lastDay = localStorage.getItem("lastDay") || new Date().toDateString();
    let achievements = JSON.parse(localStorage.getItem("achievements") || "[]");
    let draggedItem = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderTasks();
      updateStats();
      renderAchievements();
      
      // Request notification permission
      if (Notification.permission !== "granted") {
        Notification.requestPermission();
      }
      
      // Set up interval checks
      setInterval(checkNotifications, 60000);
      setInterval(dailyCheck, 60000);
      
      // Add event listeners
      addTaskBtn.addEventListener('click', addTask);
      aiSuggestBtn.addEventListener('click', generateAISuggestions);
      
      // Make tasks draggable
      setupDragAndDrop();
    });

    // Save state to localStorage
    function save() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
      localStorage.setItem("points", points);
      localStorage.setItem("streak", streak);
      localStorage.setItem("level", level);
      localStorage.setItem("lastDay", new Date().toDateString());
      localStorage.setItem("achievements", JSON.stringify(achievements));
      updateStats();
    }

    // Render tasks
    function renderTasks() {
      if (tasks.length === 0) {
        taskList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h4>No tasks scheduled</h4>
            <p>Add your first task to begin your productivity journey</p>
          </div>
        `;
        return;
      }
      
      // Sort tasks by time
      tasks.sort((a, b) => a.time.localeCompare(b.time));
      
      // Filter today's tasks
      const today = new Date().toDateString();
      const todaysTasks = tasks.filter(task => task.date === today);
      
      // Update completed count
      const completedCount = todaysTasks.filter(task => task.done).length;
      document.getElementById('completedCount').textContent = completedCount;
      document.getElementById('totalCount').textContent = todaysTasks.length;
      
      if (todaysTasks.length === 0) {
        taskList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìÖ</div>
            <h4>No tasks for today</h4>
            <p>Add tasks or check your schedule for other days</p>
          </div>
        `;
        return;
      }
      
      taskList.innerHTML = '';
      todaysTasks.forEach((task, index) => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-item ${task.done ? 'done' : ''}`;
        taskElement.draggable = true;
        taskElement.dataset.index = index;
        
        taskElement.innerHTML = `
          <div class="task-checkbox">${task.done ? '‚úì' : ''}</div>
          <div class="task-content">
            <div class="task-title">${task.name}</div>
            <div class="task-meta">
              <span>${formatTime(task.time)}</span>
              <span class="task-priority priority-${task.priority}">${task.priority}</span>
            </div>
          </div>
          <div class="task-actions">
            <button class="btn-icon" data-action="toggle" data-index="${index}">
              ${task.done ? '‚Ü©' : '‚úì'}
            </button>
            <button class="btn-icon" data-action="delete" data-index="${index}">
              ‚úï
            </button>
          </div>
        `;
        
        taskList.appendChild(taskElement);
      });
      
      // Add event listeners to buttons
      document.querySelectorAll('[data-action="toggle"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = e.target.dataset.index;
          toggleDone(index);
        });
      });
      
      document.querySelectorAll('[data-action="delete"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = e.target.dataset.index;
          deleteTask(index);
        });
      });
    }

    // Format time to AM/PM
    function formatTime(timeString) {
      const [hours, minutes] = timeString.split(':');
      const hour = parseInt(hours);
      const ampm = hour >= 12 ? 'PM' : 'AM';
      const displayHour = hour % 12 || 12;
      return `${displayHour}:${minutes} ${ampm}`;
    }

    // Add new task
    function addTask() {
      const name = document.getElementById('taskName').value.trim();
      const time = document.getElementById('taskTime').value;
      const priority = document.getElementById('taskPriority').value;
      
      if (name && time) {
        tasks.push({
          name,
          time,
          priority,
          done: false,
          date: new Date().toDateString(),
          createdAt: new Date().toISOString()
        });
        
        save();
        renderTasks();
        
        // Clear inputs
        document.getElementById('taskName').value = '';
        document.getElementById('taskTime').value = '';
        
        // Show success toast
        showToast('Task added', 'Your task has been successfully added', 'success');
        
        // Check for achievement
        if (tasks.length === 1) {
          unlockAchievement('First Step', 'You added your first task!');
        } else if (tasks.length === 5) {
          unlockAchievement('Task Collector', 'You now have 5 tasks in your list!');
        }
      } else {
        showToast('Missing information', 'Please fill in all fields', 'error');
      }
    }

    // Toggle task completion
    function toggleDone(index) {
      const task = tasks[index];
      
      if (!task.done) {
        task.done = true;
        points += getPointsForPriority(task.priority);
        streak += 1;
        
        // Show completion toast
        showToast('Task completed', `+${getPointsForPriority(task.priority)} points`, 'success');
        
        // Check for achievements
        if (streak === 3) {
          unlockAchievement('3-Day Streak', 'Keep up the good work!');
        } else if (streak === 7) {
          unlockAchievement('Week Warrior', '7 days of productivity!');
        }
        
        // Check if all tasks are done
        const allDone = tasks.filter(t => t.date === new Date().toDateString()).every(t => t.done);
        if (allDone) {
          unlockAchievement('Perfect Day', 'You completed all tasks for today!');
        }
      } else {
        task.done = false;
        points -= getPointsForPriority(task.priority);
        streak = Math.max(0, streak - 1);
        
        showToast('Task reopened', `Task marked as incomplete`, 'warning');
      }
      
      checkLevelUp();
      save();
      renderTasks();
    }

    // Get points based on priority
    function getPointsForPriority(priority) {
      switch(priority) {
        case 'high': return 25;
        case 'medium': return 15;
        case 'low': return 10;
        default: return 10;
      }
    }

    // Delete task
    function deleteTask(index) {
      tasks.splice(index, 1);
      save();
      renderTasks();
      showToast('Task deleted', 'The task has been removed', 'info');
    }

    // Check for level up
    function checkLevelUp() {
      const newLevel = Math.floor(points / 500) + 1;
      if (newLevel > level) {
        level = newLevel;
        unlockAchievement(`Level ${level}`, `Reached ${points} productivity points!`);
        createConfetti();
      }
    }

    // Update stats display
    function updateStats() {
      document.getElementById('points').textContent = points;
      document.getElementById('streak').textContent = streak;
      
      // Update progress bars
      const levelProgress = (points % 500) / 500 * 100;
      document.getElementById('levelProgress').style.width = `${levelProgress}%`;
      
      const streakProgress = Math.min(streak / 7 * 100, 100);
      document.getElementById('streakProgress').style.width = `${streakProgress}%`;
    }

    // Check for notifications
    function checkNotifications() {
      const now = new Date();
      const nowTime = now.toTimeString().slice(0, 5);
      const today = new Date().toDateString();

      tasks.forEach(task => {
        if (task.time === nowTime && !task.done && task.date === today) {
          if (Notification.permission === 'granted') {
            new Notification('‚è∞ Task Reminder', { 
              body: `It's time for: ${task.name}`,
              icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTEyLDIwQTEuNzgsMS43OCwwLDAsMSwxMC4yLDE4SDguMUExLjk0LDEuOTQsMCwwLDAsMTAsMTYuMTJWMTJBMS43OCwxLjc4LDAsMCwxLDEyLDEwQTEuNzgsMS43OCwwLDAsMSwxMy44LDEyVjE2LjFBMS45NCwxLjk0LDAsMCwwLDE1LjksMThIMTMuOEEyLDIsMCwwLDEsMTIsMjBabTAtMTJBOCw4LDAsMSwwLDIwLDEyLDgsOCwwLDAsMCwxMiw4WiIgLz48L3N2Zz4='
            });
          } else {
            showToast('Task Reminder', `It's time for: ${task.name}`, 'info');
          }
        }
      });
    }

    // Daily check for missed tasks
    function dailyCheck() {
      const today = new Date().toDateString();
      if (lastDay !== today) {
        let missed = tasks.filter(t => t.date === lastDay && !t.done).length;
        if (missed > 0) {
          points -= 20 * missed;
          streak = 0;
          showToast('Missed Tasks', `You missed ${missed} task(s) yesterday. Penalty applied!`, 'warning');
        } else if (tasks.filter(t => t.date === lastDay).length > 0) {
          // Perfect day bonus
          points += 50;
          showToast('Perfect Day', 'Bonus points for completing all tasks yesterday!', 'success');
        }
        
        lastDay = today;
        save();
      }
    }

    // Show toast notification
    function showToast(title, message, type) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-icon">
          ${type === 'success' ? '‚úì' : 
            type === 'error' ? '‚úï' : 
            type === 'warning' ? '‚ö†' : '‚Ñπ'}
        </div>
        <div class="toast-body">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close">&times;</button>
      `;
      
      toastContainer.appendChild(toast);
      
      // Show toast
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 5000);
      
      // Close button
      toast.querySelector('.toast-close').addEventListener('click', () => {
        toast.classList.remove('show');
        setTimeout(() => {
          toast.remove();
        }, 300);
      });
    }

    // Unlock achievement
    function unlockAchievement(title, message) {
      if (!achievements.some(a => a.title === title)) {
        achievements.push({ title, message, date: new Date().toISOString() });
        save();
        
        showToast(`üèÜ ${title}`, message, 'success');
        renderAchievements();
        createConfetti();
      }
    }

    // Render achievements
    function renderAchievements() {
      const achievementsList = document.getElementById('achievementsList');
      
      if (achievements.length === 0) {
        achievementsList.innerHTML = `
          <div class="empty-state" style="padding: 1rem;">
            <div class="empty-icon">üèÜ</div>
            <p>Complete tasks to earn achievements</p>
          </div>
        `;
        return;
      }
      
      // Show only last 3 achievements
      const recentAchievements = achievements.slice(-3).reverse();
      
      achievementsList.innerHTML = recentAchievements.map(achievement => `
        <div class="card" style="padding: 1rem;">
          <div style="display: flex; gap: 1rem; align-items: center;">
            <div style="font-size: 1.5rem;">üèÜ</div>
            <div>
              <div style="font-weight: 600;">${achievement.title}</div>
              <div style="font-size: 0.9rem; color: #6c757d;">${achievement.message}</div>
              <div style="font-size: 0.8rem; color: #adb5bd; margin-top: 0.25rem;">
                ${new Date(achievement.date).toLocaleDateString()}
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Create confetti effect
    function createConfetti() {
      // Clear existing confetti
      confettiContainer.innerHTML = '';
      
      // Create 50 confetti pieces
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        
        // Random properties
        const size = Math.random() * 10 + 5;
        const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
        const duration = Math.random() * 3 + 2;
        const delay = Math.random() * 2;
        
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.background = color;
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = `-${size}px`;
        confetti.style.opacity = '1';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        confetti.style.animation = `fall ${duration}s linear ${delay}s forwards`;
        
        // Add styles for animation
        const style = document.createElement('style');
        style.textContent = `
          @keyframes fall {
            to {
              transform: translateY(100vh) rotate(${Math.random() * 360}deg);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(style);
        
        confettiContainer.appendChild(confetti);
        
        // Remove confetti after animation
        setTimeout(() => {
          confetti.remove();
        }, (duration + delay) * 1000);
      }
    }

    // Generate AI suggestions
    function generateAISuggestions() {
      const commonTasks = [
        { name: "Morning workout", time: "07:00", priority: "high" },
        { name: "Read 30 minutes", time: "20:00", priority: "medium" },
        { name: "Plan next day", time: "21:30", priority: "medium" },
        { name: "Meditation session", time: "08:00", priority: "high" },
        { name: "Learn something new", time: "19:00", priority: "low" }
      ];
      
      const suggestion = commonTasks[Math.floor(Math.random() * commonTasks.length)];
      
      showToast('AI Suggestion', `How about "${suggestion.name}" at ${formatTime(suggestion.time)}?`, 'info');
      
      // Auto-fill the form
      document.getElementById('taskName').value = suggestion.name;
      document.getElementById('taskTime').value = suggestion.time;
      document.getElementById('taskPriority').value = suggestion.priority;
    }

    // Set up drag and drop for tasks
    function setupDragAndDrop() {
      taskList.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('task-item')) {
          draggedItem = e.target;
          setTimeout(() => {
            e.target.classList.add('dragging');
          }, 0);
        }
      });
      
      taskList.addEventListener('dragend', (e) => {
        if (e.target.classList.contains('task-item')) {
          e.target.classList.remove('dragging');
          draggedItem = null;
        }
      });
      
      taskList.addEventListener('dragover', (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(taskList, e.clientY);
        if (draggedItem) {
          if (afterElement) {
            taskList.insertBefore(draggedItem, afterElement);
          } else {
            taskList.appendChild(draggedItem);
          }
        }
      });
    }
    
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
  </script>
</body>
</html>